<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header" id="chatCtrl">

      <style type="text/css">
      .content-wrapper {
          height: inherit !important;
      }
      @media (min-width: 1200px){
          .container {
              width: inherit;
          }
        }
        @media (max-width: 768px){

          .content-header,.container-fluid{
            padding-left: 0px;
            padding-right: 0px;
          }
      }
         .actions {
         list-style: none;
         padding: 0;
         z-index: 2;
         margin: 0;
         }
         .actions > li {
         display: inline-block;
         vertical-align: baseline;
         }
         .actions > li > a,
         .actions > a {
         width: 30px;
         height: 30px;
         line-height: 35px;
         display: inline-block;
         text-align: center;
         position: relative;
         }
         .actions > li > a > i,
         .actions > a > i {
         -webkit-transition: color;
         -o-transition: color;
         transition: color;
         -webkit-transition-duration: 1300ms;
         transition-duration: 1300ms;
         color: #adadad;
         font-size: 20px;
         }
         .actions > li > a:hover > i,
         .actions > a:hover > i {
         color: #000;
         }
         .actions > li > a:before,
         .actions > a:before {
         left: 0;
         top: 0;
         content: "";
         position: absolute;
         width: 100%;
         height: 100%;
         -webkit-transform: scale3d(0, 0, 0);
         -moz-transform: scale3d(0, 0, 0);
         -ms-transform: scale3d(0, 0, 0);
         -o-transform: scale3d(0, 0, 0);
         transform: scale3d(0, 0, 0);
         -webkit-transition: all;
         -o-transition: all;
         transition: all;
         -webkit-transition-duration: 250ms;
         transition-duration: 250ms;
         -webkit-backface-visibility: hidden;
         -moz-backface-visibility: hidden;
         backface-visibility: hidden;
         background-color: rgba(0, 0, 0, 0.1);
         z-index: 0;
         border-radius: 50%;
         opacity: 0;
         filter: alpha(opacity=0);
         }
         .actions > li > a:hover:before,
         .actions > a:hover:before {
         -webkit-transform: scale3d(1, 1, 1);
         -moz-transform: scale3d(1, 1, 1);
         -ms-transform: scale3d(1, 1, 1);
         -o-transform: scale3d(1, 1, 1);
         transform: scale3d(1, 1, 1);
         opacity: 1;
         filter: alpha(opacity=100);
         }
         .actions > li.open > a > i,
         .actions.open > a > i {
         color: #000;
         }
         .actions > li.open > a:before,
         .actions.open > a:before {
         -webkit-transform: scale(1);
         -ms-transform: scale(1);
         -o-transform: scale(1);
         transform: scale(1);
         opacity: 1;
         filter: alpha(opacity=100);
         }
         .actions.actions-alt > li > a > i {
         color: #fff;
         }
         .actions.actions-alt > li > a > i:hover {
         color: #fff;
         }
         .actions.actions-alt > li.open > a > i {
         color: #fff;
         }
         .actions.open {
         z-index: 3;
         }
         .line-wrap {
         width: 18px;
         height: 12px;
         -webkit-transition: all;
         -o-transition: all;
         transition: all;
         -webkit-transition-duration: 300ms;
         transition-duration: 300ms;
         margin: 10px 20px;
         }
         .line-wrap .line {
         width: 18px;
         height: 2px;
         -webkit-transition: all;
         -o-transition: all;
         transition: all;
         -webkit-transition-duration: 300ms;
         transition-duration: 300ms;
         }
         .line-wrap .line.center {
         margin: 3px 0;
         }
         .open .line-wrap {
         -webkit-transform: rotate(180deg);
         -ms-transform: rotate(180deg);
         -o-transform: rotate(180deg);
         transform: rotate(180deg);
         }
         .open .line-wrap .line.top {
         width: 12px;
         transform: translateX(8px) translateY(1px) rotate(45deg);
         -webkit-transform: translateX(8px) translateY(1px) rotate(45deg);
         }
         .open .line-wrap .line.bottom {
         width: 12px;
         transform: translateX(8px) translateY(-1px) rotate(-45deg);
         -webkit-transform: translateX(8px) translateY(-1px) rotate(-45deg);
         }
         .listview{position:relative}.listview:not(.lv-lg):not(.lv-message) .lv-item{padding:5px 20px}@media (min-width: 480px){.listview.lv-lg .lv-item{padding:17px 35px 17px 25px}}@media (max-width: 767px){.listview.lv-lg .lv-item{padding:17px 35px 17px 20px}}.listview.lv-lg .lv-item:hover{background-color:#FFFFDB}.listview .lv-item{position:relative;display:block;-webkit-transition:background-color;-o-transition:background-color;transition:background-color;-webkit-transition-duration:300ms;transition-duration:300ms}.listview .lv-item .lv-small{font-size:12px;color:#A9A9A9;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:block;width:100%}.listview .lv-item .checkbox,.listview .lv-item.media{margin:0}.lvh-search-close:hover{background:#333}.lv-header-alt{position:relative;background:#f8f8f8;padding:15px}.lv-header-alt .lv-actions{z-index:3;float:right;margin-top:3px;position:relative}.lv-header-alt .lv-actions > li > a{margin:0 3px}.lvh-label{color:#818181;display:inline-block;margin:0;font-size:14px;font-weight:400;padding:0 6px;line-height:33px;vertical-align:middle}.lv-footer{display:block;text-align:center;padding:7px 14px 7px;border-top:1px solid #F0F0F0;line-height:100%;font-size:11px;margin-top:20px;color:#828282}.card{position:relative;background:#fff;box-shadow:0 1px 1px rgba(0,0,0,0.15);margin-bottom:30px}.#messages-main:before,#messages-main:after{content:" ";display:table}#messages-main:after{clear:both}#messages-main .ms-block{padding:23px 20px 0}#messages-main .ms-menu{position:absolute;left:0;top:0;background:#F8F8F8;border-right:1px solid #EEE;padding-bottom:50px;height:100%;width:240px;-webkit-transition:all;-o-transition:all;transition:all;-webkit-transition-duration:250ms;transition-duration:250ms}@media (max-width: 767px){#messages-main .ms-menu{height:calc(100% - 58px);-webkit-transform:translate3d(-240px,58px,0);transform:translate3d(-240px,58px,0);opacity:0;filter:alpha(opacity=0);z-index:1}#messages-main .ms-menu.toggled{-webkit-transform:translate3d(0,58px,0);transform:translate3d(0,58px,0);opacity:1;filter:alpha(opacity=100)}}#messages-main .ms-menu .lv-item.active{background:#fff}#messages-main .ms-menu .lv-item:not(.active):hover{background:#F2F2F2;cursor:pointer}@media (min-width: 768px){#messages-main .ms-body{padding-left:240px}}@media (max-width: 767px){#messages-main .ms-body{overflow:hidden}}#messages-main .ms-user:before,#messages-main .ms-user:after{content:" ";display:table}#messages-main .ms-user:after{clear:both}#messages-main .ms-user:before,#messages-main .ms-user:after{content:" ";display:table}#messages-main .ms-user:after{clear:both}#messages-main .ms-user > img{border-radius:50%;width:40px;float:left}#messages-main .ms-user > div{overflow:hidden;padding:7px 5px 7px 15px;font-size:11px}#messages-main #ms-compose{position:fixed;bottom:120px;z-index:1;right:30px;box-shadow:0 0 4px rgba(0,0,0,0.14),0 4px 8px rgba(0,0,0,0.28)}#ms-menu-trigger{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;float:left;margin:1px 0 0 -7px}@media (min-width: 768px){#ms-menu-trigger{display:none}}#ms-menu-trigger .line-wrap .line{background-color:#717171}.lv-message .lv-item{padding:20px}.lv-message .lv-item.right{text-align:right}.lv-message .lv-item.right .lv-avatar{margin-right:0;margin-left:15px}.lv-message .lv-item:not(.right) .ms-item{background-color:#f5f5f5;color:#7c7c7c;box-shadow: 0 1.5px .5px rgba(0,0,0,.13);}.lv-message .lv-item.right .ms-item{background:#ecf0f1;box-shadow: 0 1.5px .5px rgba(0,0,0,.13); color:#7c7c7c;}.lv-avatar{width:35px;height:35px;border-radius:50%;color:#FFF;text-align:center;line-height:34px;font-size:15px;margin-right:15px;padding:0!important;text-transform:uppercase}.lv-avatar > img{width:35px;height:35px;border-radius:50%;vertical-align:top}.ms-item{padding:13px 19px 15px;border-radius:2px;display:inline-block}@media (min-width: 768px){.ms-item{max-width:70%}}.ms-date{display:block;color:#B3B3B3;margin-top:7px; margin-left:3px;}.ms-date > i{font-size:14px;vertical-align:bottom;line-height:100%}.ms-reply{ background-color:#f5f5f5;position:relative;margin:0!important}.ms-reply textarea{width:94%; margin-left:-50px; resize:none;  border-style: none;border-color: Transparent;   overflow: auto;   font-size:15px; padding:10px;font-style:normal;height:45px;}.ms-reply button{position:absolute;top:0;right:0;border:0;height:100%;width:60px;font-size:25px;background:#F5F5F5;color:#999}.ms-reply button:hover{background:#f2f2f2; color:#7c7c7c}
         textarea:focus {outline: none !important;border-color: #719ECE;}
         .user-detail{ border:none !important; border-radius:0px; z-index:9999;}
         #ms-scrollbar::-webkit-scrollbar-track
         {
         background-color:#CCCCCC;
         }
         #ms-scrollbar::-webkit-scrollbar
         {
         width: 7px;
         background-color: #F5F5F5;
         }
         #ms-scrollbar::-webkit-scrollbar-thumb
         {
         background-color:#eeeeee;
         -webkit-box-shadow: inset 0 0 0px rgba(0,0,0,0.3);
         }

         .lv-avatar {
           width: auto;
           text-transform: inherit;
          }
         .ms-new{box-shadow:0 2px 5px rgba(0,0,0,0.16),0 2px 10px rgba(0,0,0,0.12); background-color:#2196f3;}
      </style>
   <body>
      <div class="container-fluid">
         <div class="container ng-scope">
            <div class="block-header">
               <h2> </h2>
            </div>
            <div class="card m-b-0" id="messages-main" style="box-shadow:0 0 40px 1px #c9cccd;">
               <div class="ms-menu"  style="overflow:scroll; overflow-x: hidden;" id="ms-scrollbar">
                  <div class="ms-block">
                     <div class="ms-user">
                        <img src="./images/avatar.jpg" alt="">
                        <h5 class="q-title" align="center">
                          Channel List  ({{roomList.length}})
                        </h5>
                     </div>
                  </div>
                  <div class="listview lv-user m-t-20">
                     <div class="lv-item media" style="text-align: center;" ng-repeat="room in roomList">

                        <div class="media-body">
                           <a ng-click="startChat(room.id,room.userIds)"><div class="lv-title">{{room.name}}</div></a>
                        </div>
                     </div>

                  </div>
               </div>
               <div class="ms-body">
                  <div class="listview lv-message">
                     <div class="lv-header-alt clearfix">
                        <div id="ms-menu-trigger">
                           <div class="line-wrap">
                              <div class="line top"></div>
                              <div class="line center"></div>
                              <div class="line bottom"></div>
                           </div>
                        </div>
                        <div class="lvh-label hidden-xs">
                          <span class="c-black">{{currentUser.name}}<span ng-if='userOnline' style=" margin-left:8px; position:absolute; margin-top:12px;width: 8px;height: 8px;line-height: 8px;border-radius: 50%; background-color:#80d3ab;"></span><span ng-if='!userOnline' style="margin-left:8px; position:absolute; margin-top:12px;width: 8px;height: 8px;line-height: 8px;border-radius: 50%; background-color:#9a9e9c;"></span></span>
                        </div>
                        <ul class="lv-actions actions list-unstyled list-inline">
                           <li>
                              <a href="#" ng-click="openAddUserToRoomModal()" >
                              <i class="fa fa-plus"></i>
                              </a>
                           </li>
                           <li style="display:none">
                              <a href="#" >
                              <i class="fa fa-clock-o"></i>
                              </a>
                           </li>
                           <li  ng-if="userIds.length>0">
                              <a data-toggle="dropdown" href="#" > <i class="fa fa-list"></i></a>
                              <ul class="dropdown-menu user-detail" role="menu">
                                 <li ng-repeat="user in userIds" ng-if="currentUser.id!=user.id">
                                    <a href="">
                                      <span ng-if="user.presence" style="margin-left:8px; position:absolute; margin-top:8px;width: 8px;height: 8px;line-height: 8px;    border-radius: 50%; background-color:#80d3ab;">
                                      </span>
                                      <span ng-if="!user.presence" style="margin-left:8px; position:absolute; margin-top:8px;width: 8px;height: 8px;line-height: 8px;    border-radius: 50%; background-color:#9a9e9c;">
                                      </span>
                                      <span style="margin-left: 22px;width: 8px;line-height: 8px;border-radius: 50%;">
                                        {{user.id}}
                                      </span>
                                    </a>
                                 </li>
                              </ul>
                           </li>
                           <li style="display:none">
                              <a data-toggle="dropdown" href="#" data-toggle="tooltip" data-placement="left" title="Tooltip on left"><span class="glyphicon glyphicon-trash"></span></a>
                              <ul class="dropdown-menu user-detail" role="menu">
                                 <li>
                                    <a href="">Delete Messages</a>
                                 </li>
                              </ul>
                           </li>
                        </ul>
                     </div>
                     <div class="lv-body" id="ms-scrollbar" style="overflow:scroll; overflow-x: hidden; height:520px;">
                        <div ng-repeat="msg in chatMessages" >

                          <div class="lv-item media " ng-if="msg.senderId != currentUser.id">
                             <div class="lv-avatar pull-left" style="color:#7c7c7c">
                                <strong>{{msg.senderId}}</strong>
                             </div>
                             <div class="media-body">
                                <div class="ms-item">
                                  {{msg.text}}
                                </div>
                                <small class="ms-date"><span class="glyphicon glyphicon-time"></span>&nbsp;{{msg.updatedAt}}</small>
                             </div>
                          </div>
                          <div class="lv-item media right" ng-if="msg.senderId == currentUser.id" id="{{$index == (chatMessages.length-1)}}">
                             <div class="lv-avatar pull-right" style="color:#7c7c7c">
                                <strong>{{msg.senderId}}</strong>
                             </div>

                             <div class="media-body">
                                <div class="ms-item">
                                  {{msg.text}}
                                </div>
                                <small class="ms-date"><span class="glyphicon glyphicon-time"></span>&nbsp;{{msg.updatedAt}}</small>
                             </div>

                          </div>
                          <div ng-if="$index == (chatMessages.length-1)" style="float:left;color:#7c7c7c;padding:10px 20px;" style="float:left" id='scrollDiv'></div>
                      </div>
                     </div>
                     <div class="clearfix"></div>
                     <div class="lv-footer ms-reply" ng-show="roomId!=''">
                        <textarea rows="10" ng-model="msg" ng-keydown="isTypingIn()" placeholder="Write messages..."></textarea>
                        <button class="" ng-click="sendMsg()"><span class="glyphicon glyphicon-send"></span></button>
                     </div>
                     <div class="lv-footer ms-reply" style="font-size: inherit;float: right;margin-right: 70px !important;  bottom: 46px;background-color: transparent;border: none;">
                        <label>{{typingStatus}}</label>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
      </div>
      </div>
    </body>
      </section>


        <div class="modal fade" id="addUserToRoomModal">
            <div class="modal-dialog" style="width:60%">
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span></button>
                  <div class="row">
                    <div class="col-sm-8 col-sm-2-offset">
                    <div class="col-sm-6">
                        <input type="radio" name="oldNewUser" value="oldUser" ng-model="oldNewUserValue" ng-click="showExistingUserList()" checked> Add Existing User
                    </div>
                    <div class="col-sm-6" ng-show="roomId!=''">
                        <input type="radio" name="oldNewUser" value="newUser" ng-model="oldNewUserValue" ng-click="showExistingUserList()" > Create New User
                    </div>
                  </div>
                </div>
                <div class="modal-header">

                  <h4 ng-show="oldNewUserValue == 'oldUser'" class="modal-title"> Add Existing User</h4>
                  <h4 ng-show="oldNewUserValue != 'oldUser'" class="modal-title"> Create New User</h4>
                </div>
                <div class="modal-body" ng-show="oldNewUserValue == 'oldUser'">
                    <form id="addUsersForm">
                        <div class="row">

                          <div class="col-sm-8">
                              <div class="form-group has-feedback">
                                  <select class="form-control select2 form-control" multiple="multiple" ng-model="users" id="users" name="users" style="width: 100%;">

                                      <option value="{{user.id}}" ng-repeat="user in userList" ng-if="user.isShow">{{user.name}}</option>
                                  </select>
                              </div>
                          </div>
                          <div class="col-sm-4">
                              <div class="form-group has-feedback" style="width: 100%;">
                                <button type="button" ng-click="addUserToRoom(users)" style="width: 100%;" class="btn btn-primary">Add</button>
                              </div>
                          </div>
                          </div>
                      </form>

                </div>
                <div class="modal-body" ng-show="oldNewUserValue != 'oldUser'">
                    <form id="createUsersForm">
                        <div class="row">

                          <div class="col-sm-4">
                              <div class="form-group has-feedback">
                                    <input type="text" placeholder="Enter User Name" class="form-control" ng-model="userName" id="userName" name="userName" style="width: 100%;" />
                              </div>
                          </div>
                          <div class="col-sm-4">
                              <div class="form-group has-feedback">
                                    <input type="text" placeholder="Enter User ID" class="form-control" ng-model="userId" id="userId" name="userId" style="width: 100%;" />
                              </div>
                          </div>
                          <div class="col-sm-4">
                              <div class="form-group has-feedback">
                                    <input type="text" placeholder="Enter User Email" class="form-control" ng-model="userEmail" id="userEmail" name="userEmail" style="width: 100%;" />
                              </div>
                          </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer" ng-show="oldNewUserValue != 'oldUser'">
                  <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
                    <button type="button" ng-click="createNewUser()" class="btn btn-primary">Create</button>
                </div>
              </div>
              <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
          </div>
          <!-- /.modal -->
      <script>


      // function connect2(){
      //   chatManager.connect()
      //   .then(currentUser => {
      //     console.log('uesr 2 Successful connection', currentUser);
      // 		user=currentUser;
      //   })
      //   .catch(err => {
      //     console.log('Error on connection', err)
      //   })
      // }
      //
      // function createRoom(){
      // user.createRoom({
      //   name: 'general',
      //   private: false,
      //   addUserIds: ['yogesh_tester','yogesh_tester2']
      // }).then(room => {
      //   console.log(`Created room called ${room.name}`)
      //   subscribed()
      // })
      // .catch(err => {
      //   console.log(`Error creating room ${err}`)
      // })
      // }
      //
      // function addToRoom(){
      //
      // user.addUserToRoom({
      //   userId: 'yogesh_tester3',
      //   roomId: someRoomId
      // })
      //   .then(room => {
      //     console.log('Added keith to yogesh_tester3',room);
      //   }).catch(err => {
      //     console.log(`Error adding keith to room 123: ${err}`)
      //   })
      //
      //
      // }
      //
      // function checkJoinedGroup(){
      // 	user.getJoinableRooms()
      // 	  .then(rooms => {
      // 		console.log('Created room called', rooms);
      // 	  })
      // 	  .catch(err => {
      // 		console.log(`Error getting joinable rooms: ${err}`)
      // 	  })
      // }
      // function subscribed(){
      // 	user.subscribeToRoom({
      // 	  roomId: someRoomId,
      // 	  hooks: {
      // 		onNewMessage: message => {
      //
      // 		  console.log(`Received new message ${message.text}`)
      // 		},
      // 		onUserStartedTyping: data => {
      // 		console.log(`User ${data.name} started typing`)
      // 		},
      // 		onUserStoppedTyping: data => {
      // 		  console.log(`User ${data.name} stopped typing`)
      // 		},
      // 		onUserCameOnline: (data) => {
      // 		  console.log(`User ${data.name} came online`)
      // 		},
      // 		onUserWentOffline: (data) => {
      // 		  console.log(`User ${data.name} went offline`)
      // 		}
      // 	  },
      // 	  messageLimit: 10
      // 	})
      // }
      //
      // function sendMsg(){
      // user.sendMessage({
      //   text: "Hi there!",
      //   roomId: someRoomId
      // })
      // .then(messageId => {
      //   console.log(`Added message to ${someRoomId}`)
      // })
      // .catch(err => {
      //   console.log(`Error adding message to ${someRoomId}: ${err}`)
      // })
      // }
      //
      // function isTyping(){
      // user.isTypingIn({ roomId: someRoomId })
      //   .then(() => {
      //     console.log('Typing...',user)
      //   })
      //   .catch(err => {
      //     console.log(`Error sending typing indicator: ${err}`)
      //   })
      //
      //
      // }
      //
      $(function(){
        jQuery.validator.addMethod("customEmail", function (value, element) {
           return  this.optional(element) || /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(value);
       }, "Please enter a valid Email address.");

        $('#addUsersForm').validate({
            errorElement: 'span', //default input error message container
            errorClass: 'help-block help-block-error', // default input error message class
            focusInvalid: false, // do not focus the last invalid input
            ignore: "", // validate all fields including form hidden input
            rules: {
                users: {
                    required: true,
                }
            },
            highlight: function (element) { // hightlight error inputs
                $(element)
                        .closest('.form-group').addClass('has-error'); // set error class to the control group
            },
            unhighlight: function (element) { // revert the change done by hightlight
                $(element)
                        .closest('.form-group').removeClass('has-error'); // set error class to the control group
            },
            success: function (label) {
                label
                        .closest('.form-group').removeClass('has-error'); // set success class to the control group
            }
        });
        $('#createUsersForm').validate({
            errorElement: 'span', //default input error message container
            errorClass: 'help-block help-block-error', // default input error message class
            focusInvalid: false, // do not focus the last invalid input
            ignore: "", // validate all fields including form hidden input
            rules: {
                userName: {
                    required: true,
                },
                userId: {
                    required: true,
                },
                userEmail: {
                    required: true,
                    customEmail: true
                }
            },
            highlight: function (element) { // hightlight error inputs
                $(element)
                        .closest('.form-group').addClass('has-error'); // set error class to the control group
            },
            unhighlight: function (element) { // revert the change done by hightlight
                $(element)
                        .closest('.form-group').removeClass('has-error'); // set error class to the control group
            },
            success: function (label) {
                label
                        .closest('.form-group').removeClass('has-error'); // set success class to the control group
            }
        });
      })


      </script>

  </div>
